<?php

				// Preis berechnen
				$bestell_preis = 0;
				$max_prod_preis     = 0;
				for ($i = 0; $i < count($gebindegroessen); $i++) {
				   if ($gebindepreis[$i] > $max_prod_preis) $max_prod_preis = $gebindepreis[$i];
					 
				   if (!$gesamt_liste)
					    $bestell_preis += $gruppenMengeInGebinde[$i] * $gebindepreis[$i];
					 else
					    $bestell_preis += $festeGebindeaufteilung[$i] * $gebindepreis[$i] * $gebindegroessen[$i]; // benni: variable $gebindegroessen[$i] hinzugef√ºgt
				}
				//$max_preis = $bestell_preis - ($gruppenToleranzInGebinde * $gebindepreis[$toleranzGebNr]);
				//$max_preis += $max_prod_preis * ($gruppeGesamtMengeNichtInGebinden + $gruppenToleranzInGebinde + $gruppenToleranzNichtInGebinde);
				//$bestell_preis += $max_prod_preis * ($gruppeGesamtMengeNichtInGebinden + $gruppenToleranzNichtInGebinde);
				
				$gesamt_preis += $bestell_preis;
				//$max_gesamt_preis += $max_preis;
				
				$anzGeb = 0;
				for ($i=0; $i < count($festeGebindeaufteilung); $i++) $anzGeb += $festeGebindeaufteilung[$i];
				
				if ((!$gesamt_liste && !$bestgroup_view) || ($gesamt_liste && $anzGeb > 0) || ($bestgroup_view && ($gruppeGesamtMengeInGebinden + $gruppenToleranzInGebinde > 0)) ) {
			 
			 if ($mutli_group) {
?>
	<tr>
	   <td valign="top"><b><?PHP echo $produkt_row['name'];  ?></b></td>
		 <!-- <td valign="top"><?PHP echo $lieferanten_id2name[$produkt_row['lieferanten_id']]; ?></td> -->
		 <td valign="top"><?PHP echo "<b>".($gruppeGesamtMengeInGebinden + $gruppenToleranzInGebinde)."</b> (".$gruppenToleranzInGebinde.")"; ?></td>
		 <td>
		    <table class="inner">
		    <?PHP
								  // Preise zum aktuelle Produkt auslesen..
									$prod_ges_preis = 0;
								  $result2 = mysql_query("SELECT  id, gebindegroesse, bestellnummer, preis FROM  produktpreise WHERE zeitstart <= '".mysql_escape_string($row_gesamtbestellung['bestellstart'])."' AND (ISNULL(zeitende) OR zeitende >= '".mysql_escape_string($row_gesamtbestellung['bestellende'])."') AND produkt_id=".mysql_escape_string($produkt_row['id'])." ORDER BY gebindegroesse;") or error(__LINE__,__FILE__,"Konnte Produktpreise nich aus DB laden..",mysql_error());												
									for ($i = count($gebindegroessen)-1; $i >= 0; $i--) {
									   $preise_row = mysql_fetch_array($result2);
										 
										 echo
										 "<tr><td>DRDA".$gruppenMengeInGebinde[$i]."</td><td>x</td><td>".$preise_row['preis']."</td></tr>\n";
										 $prod_ges_preis += $gruppenMengeInGebinde[$i] * $preise_row['preis'];
										 
									}
?>
					</table>
		 </td>
		 <td>
		   <table class="inner">
		    <?PHP
								  $result2 = mysql_query("SELECT  id, gebindegroesse, bestellnummer, preis FROM  produktpreise WHERE zeitstart <= '".mysql_escape_string($row_gesamtbestellung['bestellstart'])."' AND (ISNULL(zeitende) OR zeitende >= '".mysql_escape_string($row_gesamtbestellung['bestellende'])."') AND produkt_id=".mysql_escape_string($produkt_row['id'])." ORDER BY gebindegroesse;") or error(__LINE__,__FILE__,"Konnte Produktpreise nich aus DB laden..",mysql_error());												
									for ($i = count($gebindegroessen)-1; $i >= 0; $i--) {
									   $preise_row = mysql_fetch_array($result2);
										 
										 echo "<tr><td>".$preise_row['gebindegroesse']."</td><td>x</td><td>".$produkt_row['einheit']."</td></tr>\n";
										 
									}
?>
				</table>
		 </td>
		 <td><?PHP echo $prod_ges_preis; ?></td>
		 <td width="50px"></td>
		 <td width="50px">.</td>
	</tr>

<?PHP
			} else {
?>

		<tr>
			 <td valign="top"><b><?PHP if ($gesamt_liste) echo "<a href=\"javascript: window.open('windows/showBestelltProd.php?bestellt_pwd=".$gruppen_pwd."&produkt_id=".$produkt_row['id']."&bestellung_id=".$bestell_id."','insertProdukt','width=600,height=500,left=50,top=50').focus()\" style='text-decoration:none;'>"; echo $produkt_row['name']; if ($gesamt_liste) echo "</a>"; ?></b>
			 <br>
			 
			 <?PHP
			 echo "<a
			 href=\"nichtGeliefert.php?bestellt_pwd=".$gruppen_pwd."&produkt_id=".$produkt_row['id']."&bestellung_id=".$bestell_id."\" target=_blank>nicht
			 geliefert</a>"
			 ?>
			 </td>
			 <td valign="top"><?PHP echo $produktgruppen_id2name[$produkt_row['produktgruppen_id']]; ?></td>
			 <td valign="top"><?PHP echo $lieferanten_id2name[$produkt_row['lieferanten_id']]; ?></td>
			 <td valign="top">
			    <table border="0" width="100%"  class="inner">
							 <?PHP 
							
								  // Preise zum aktuelle Produkt auslesen..
								  $result2 = mysql_query("SELECT  id, gebindegroesse, bestellnummer, preis FROM  produktpreise WHERE zeitstart <= '".mysql_escape_string($row_gesamtbestellung['bestellstart'])."' AND (ISNULL(zeitende) OR zeitende >= '".mysql_escape_string($row_gesamtbestellung['bestellende'])."') AND produkt_id=".mysql_escape_string($produkt_row['id'])." ORDER BY gebindegroesse;") or error(__LINE__,__FILE__,"Konnte Produktpreise nich aus DB laden..",mysql_error());												
									for ($i = count($gebindegroessen)-1; $i >= 0; $i--) {
									   $preise_row = mysql_fetch_array($result2);
										 
										 if ($toleranzGebNr == $i) { 
										    $toleranz_color_str = "style='color:#999999'";
										 } else {
										    $toleranz_color_str="";
										 }	
										 
										 if ($gesamt_liste)
										    echo "<tr><td width='50px'><b><span id='anz_prod(".$produkt_row['id'].")geb(".$i.")' ".$toleranz_color_str." >".$festeGebindeaufteilung[$i]."</span> - </b></td><td>".$preise_row['gebindegroesse']." * ".$produkt_row['einheit']."</td><td align='right'></td><td align='right'>".sprintf("%.02f",$preise_row['preis'])."</td></tr>";
										 else
										    echo "<tr><td width='50px'><b><span id='anz_prod(".$produkt_row['id'].")geb(".$i.")' ".$toleranz_color_str." >".$festeGebindeaufteilung[$i]."</span> - </b></td><td>".$preise_row['gebindegroesse']." * ".$produkt_row['einheit']."</td><td align='right'></td><td align='right'>".sprintf("%.02f",$preise_row['preis'])."</td></tr>";
     echo "<tr><td><span style='font-size:0.8em'>best_nr:".$preise_row['bestellnummer']."</span></td></tr>";
									}
								 
							 ?>
			    </table>
			 </td>
			 <td valign="top">
			 
			    <table border="0" width="100%"  class="inner">
					   <tr>
						    <?PHP
								   if ($gesamt_liste) {
								?>
								      <td align="right" ><b><span id="menge_gesamt_<?PHP echo $produkt_row['id']; ?>"><?PHP echo $gesamtBestellmengeFest[$produkt_row['id']]; ?></span></b></td>
								<?PHP 
								  } else {
								?>
								   <td align="left" ><span style="color:#00FF00"><b><span id="menge_geb_<?PHP echo $produkt_row['id']; ?>"><?PHP echo $gruppeGesamtMengeInGebinden; ?></span></span> +  <span style="color:#FF0000"><spam id="menge_nichtgeb_<?PHP echo $produkt_row['id']; ?>"><?PHP echo $gruppeGesamtMengeNichtInGebinden; ?></span></span></b> / <span id="menge_gesamt_<?PHP echo $produkt_row['id']; ?>"><?PHP echo $gesamtBestellmengeFest[$produkt_row['id']]; ?></span></td>
								<?PHP
								  }
								?>
						</tr>
					</table>						 

			 </td>
			 <td valign="top">
			 
			    <table border="0" width="100%" class="inner">
					   <tr>
						    <?PHP
								   if ($gesamt_liste) {
								?>
								      <td align="right" ><b><?PHP echo $gesamtBestellmengeToleranz[$produkt_row['id']]; ?></b></td>
								<?PHP 
								  } else {
								?>
								   <td align="left"><span color="#00FF00"><b><span id="toleranz_geb_<?PHP echo $produkt_row['id']; ?>"><?PHP echo $gruppenToleranzInGebinde; ?></span></span> +  <span style="color#FF0000"><span id="toleranz_nichtgeb_<?PHP echo $produkt_row['id']; ?>"><?PHP echo $gruppenToleranzNichtInGebinde; ?></span></span></b> / <span id="toleranz_gesamt_<?PHP echo $produkt_row['id']; ?>"><?PHP echo $gesamtBestellmengeToleranz[$produkt_row['id']]; ?></span></td>
								<?PHP
								  }
								?>
						</tr>
				 </table>						 

			 </td>
<td valign="bottom" align="right" id="kosten_colum_<?PHP echo $produkt_counter; ?>"><b><span id="kosten_<?PHP echo $produkt_row['id']; ?>"><?PHP echo sprintf("%.02f",$bestell_preis); ?></span></b>
			 </td>
		</tr>

<?PHP
}
	}
	 
$produkt_counter++;
	}
?>
